<!DOCTYPE html>
<html lang="en" class="h-full" data-theme="<%= current_theme %>">
  <head>
    <%# Theme initialization - runs before page paint to prevent flash %>
    <script>
      (function() {
        const theme = localStorage.getItem('theme') || '<%= current_theme %>';
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>

    <title><%= content_for(:title) || "California Small Claims Court Forms" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="Free online tool to fill out California Small Claims Court forms. Generate print-ready PDFs for your court case.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="CA Small Claims Forms">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-screen bg-base-100 text-base-content">
    <!-- Navigation -->
    <nav class="navbar bg-primary text-primary-content shadow-lg">
      <div class="navbar-start">
        <%= link_to root_path, class: "btn btn-ghost normal-case text-xl gap-2" do %>
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <span class="hidden sm:inline">CA Small Claims</span>
        <% end %>
      </div>

      <div class="navbar-center hidden lg:flex">
        <ul class="menu menu-horizontal px-1">
          <li><%= link_to "Forms", forms_path %></li>
          <li><%= link_to "Workflows", workflows_path %></li>
          <li><%= link_to "My Forms", submissions_path %></li>
        </ul>
      </div>

      <div class="navbar-end gap-2">
        <%# Theme Toggle Button %>
        <button type="button"
                class="btn btn-ghost btn-circle"
                data-controller="theme"
                data-action="click->theme#openModal"
                title="Change theme"
                aria-label="Change theme">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
          </svg>
        </button>

        <% if user_signed_in? %>
          <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar placeholder">
              <div class="bg-neutral text-neutral-content rounded-full w-10">
                <span class="text-sm"><%= current_user.display_name.first(2).upcase %></span>
              </div>
            </div>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 text-base-content rounded-box w-52">
              <li class="menu-title"><%= current_user.display_name %></li>
              <li><%= link_to "My Forms", submissions_path %></li>
              <li><%= link_to "Sign Out", destroy_user_session_path, data: { turbo_method: :delete } %></li>
            </ul>
          </div>
        <% else %>
          <%= link_to "Sign In", new_user_session_path, class: "btn btn-ghost btn-sm" %>
          <%= link_to "Register", new_user_registration_path, class: "btn btn-secondary btn-sm" %>
        <% end %>

        <%# Mobile menu button %>
        <div class="dropdown dropdown-end lg:hidden">
          <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </div>
          <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 text-base-content rounded-box w-52">
            <li><%= link_to "Forms", forms_path %></li>
            <li><%= link_to "Workflows", workflows_path %></li>
            <li><%= link_to "My Forms", submissions_path %></li>
            <li>
              <button type="button"
                      data-controller="theme"
                      data-action="click->theme#openModal"
                      class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
                Theme
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    <% if notice.present? %>
      <div class="container mx-auto px-4 mt-4">
        <div role="alert" class="alert alert-success">
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span><%= notice %></span>
        </div>
      </div>
    <% end %>

    <% if alert.present? %>
      <div class="container mx-auto px-4 mt-4">
        <div role="alert" class="alert alert-error">
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span><%= alert %></span>
        </div>
      </div>
    <% end %>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="footer footer-center p-10 bg-base-200 text-base-content mt-auto">
      <nav class="grid grid-flow-col gap-4">
        <a href="https://selfhelp.courts.ca.gov/small-claims" target="_blank" class="link link-hover">CA Courts Self-Help</a>
        <a href="https://www.courts.ca.gov/forms.htm" target="_blank" class="link link-hover">Official Court Forms</a>
        <%= link_to "Help & FAQ", help_path, class: "link link-hover" %>
      </nav>
      <aside>
        <p class="text-sm">
          A free, open-source tool to help Californians fill out Small Claims Court forms online.
          <br>
          This tool provides form assistance only. It is not legal advice. Consult an attorney for legal questions.
        </p>
        <p class="text-xs mt-2 opacity-60">
          Open source software released under the MIT License.
          <%= link_to "View on GitHub", "https://github.com/example/ca-small-claims", target: "_blank", class: "link" %>
        </p>
      </aside>
    </footer>

    <%# Theme Selector Modal - globally available %>
    <%= render "shared/theme_modal" %>
  </body>
</html>
